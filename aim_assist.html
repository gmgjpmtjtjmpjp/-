<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<title>マグネットカーソル（示例）</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:system-ui, -apple-system, Meiryo, sans-serif; padding:20px;}
  .aimable{display:inline-block; padding:6px 8px; margin:6px; border-radius:6px; background:#eef; cursor:pointer;}
  #guide{margin-bottom:12px;color:#555}
  #customCursor{
    position:fixed; width:18px; height:18px; border-radius:50%;
    transform:translate(-50%,-50%); pointer-events:none;
    background:rgba(255,80,80,0.9); box-shadow:0 0 10px rgba(255,80,80,0.6);
    transition: transform 0.06s linear, width 0.06s linear, height 0.06s linear;
    z-index:99999;
    display:none;
  }
  #settings{margin-top:12px; font-size:14px}
  label{display:inline-block;margin-right:10px}
  .highlight{outline:3px solid rgba(255,200,80,0.9); outline-offset:3px; border-radius:6px;}
</style>
</head>
<body>

<div id="guide">
  <strong>説明：</strong>このページ内の<span style="background:#ffd">.aimable</span>要素にカスタムカーソルが吸い付きます。<br>
  「Space」キーまたは画面タップで吸着先をクリックできます。ブラウザ外・別タブには影響しません。
</div>

<div id="settings">
  <label>感度（px）: <input id="threshold" type="number" value="60" min="10" style="width:80px"></label>
  <label>最大吸着距離（px）: <input id="maxdist" type="number" value="240" min="20" style="width:80px"></label>
  <label><input id="enableToggle" type="checkbox" checked> 有効</label>
</div>

<hr>

<!-- サンプルの「狙える」要素 -->
<div>
  <button class="aimable">ボタン A</button>
  <button class="aimable">ボタン B</button>
  <a class="aimable" href="https://example.com" target="_blank">リンク C</a>
  <div class="aimable" tabindex="0">カード D</div>
  <button class="aimable">ボタン E</button>
  <button class="aimable">ボタン F</button>
  <div style="height:600px"></div>
  <button class="aimable">一番下のボタン</button>
</div>

<div id="customCursor" aria-hidden="true"></div>

<script>
(function(){
  const cursor = document.getElementById('customCursor');
  const enabledCheckbox = document.getElementById('enableToggle');
  const thresholdInput = document.getElementById('threshold');
  const maxdistInput = document.getElementById('maxdist');
  const aimablesSelector = '.aimable';
  let aimables = Array.from(document.querySelectorAll(aimablesSelector));
  let enabled = enabledCheckbox.checked;
  let hovering = false;
  let currentTarget = null;

  // show custom cursor when enabled
  function updateCursorVisibility(){
    if(enabled) cursor.style.display = 'block';
    else { cursor.style.display = 'none'; removeHighlight(); currentTarget = null; }
  }
  updateCursorVisibility();

  enabledCheckbox.addEventListener('change', ()=>{ enabled = enabledCheckbox.checked; updateCursorVisibility(); });

  // utility: center of element in viewport coords
  function centerOf(el){
    const r = el.getBoundingClientRect();
    return {x: r.left + r.width/2, y: r.top + r.height/2};
  }

  // find nearest aimable element within maxdist
  function findNearest(x,y){
    const maxdist = Number(maxdistInput.value) || 300;
    let best = null; let bestDist = Infinity;
    aimables.forEach(el=>{
      const c = centerOf(el);
      const dx = c.x - x, dy = c.y - y;
      const d = Math.hypot(dx,dy);
      if(d < bestDist && d <= maxdist) { bestDist = d; best = {el,dist:d,center:c}; }
    });
    return best;
  }

  function removeHighlight(){
    if(currentTarget){
      currentTarget.el.classList.remove('highlight');
      currentTarget = null;
    }
  }

  // main mousemove: update custom cursor and snap if within threshold
  window.addEventListener('
